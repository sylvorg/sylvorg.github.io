<<\EOF
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-04-24 Sun 02:51 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Jeet Ray" />
<link rel="stylesheet" type="text/css" href="https://combinatronics.com/sylvorg/settings/main/src/styles/primary/syvl.css" />
<link rel="icon" href="https://combinatronics.com/sylvorg/settings/main/src/icons/favicons/shiny-alolan-sandshrew.ico" sizes="any" />
<link rel="icon" href="https://combinatronics.com/sylvorg/settings/main/src/icons/favicons/shiny-alolan-sandshrew.svg" />
<link rel="manifest" href="https://combinatronics.com/sylvorg/settings/main/manifest.json" />
<link rel="stylesheet" type="text/css" href="https://combinatronics.com/sylvorg/settings/main/src/styles/highlight/paraiso-dark.min.css" />
<script src="https://combinatronics.com/sylvorg/settings/main/src/scripts/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
<div class="header">
<h1>We Are Syvlorg.</h1>
<a href="">About Me</a>
<a href="">About This Website</a>
<a href="">About Syvlorg</a>
<a href="https://resume.syvl.org">Résumé</a>
<a href="https://index.syvl.org">Index</a>
</div>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#b2bb02de-0ced-4df2-a6f5-2734845e163f">CNAME</a></li>
<li><a href="#697a3a77-89eb-4408-8cac-a5001e05daa2">index.hy</a></li>
<li><a href="#f3e32608-7200-4808-9d42-59112f32d395">index.html</a></li>
<li><a href="#orge0df3d0">makefile</a></li>
</ul>
</div>
</div>

<div id="outline-container-b2bb02de-0ced-4df2-a6f5-2734845e163f" class="outline-2">
<h2 id="b2bb02de-0ced-4df2-a6f5-2734845e163f">CNAME</h2>
<div class="outline-text-2" id="text-b2bb02de-0ced-4df2-a6f5-2734845e163f">
<div class="org-src-container">
<pre><code class="language-plaintext match-braces rainbow-braces">syvl.org
</code></pre>
</div>
</div>
</div>

<div id="outline-container-697a3a77-89eb-4408-8cac-a5001e05daa2" class="outline-2">
<h2 id="697a3a77-89eb-4408-8cac-a5001e05daa2">index.hy</h2>
<div class="outline-text-2" id="text-697a3a77-89eb-4408-8cac-a5001e05daa2">
<div class="org-src-container">
<pre><code class="language-hy match-braces rainbow-braces">"
#! nix-shell -p python310 python310Packages.bakery yadm git gnumake fd emacs
#! nix-shell -I nixpkgs=https://github.com/shadowrylander/nixpkgs/archive/j.tar.gz
#! nix-shell -i hy
"
</code></pre>
</div>

<div class="org-src-container">
<pre><code class="language-hy match-braces rainbow-braces">(import sys [argv])
(del (get argv 0))

(import bakery)
(import bakery [make nixos-generate-config yadm zfs])
(import click)
(import os [path])
(import pathlib [Path])
(import stat)
(import socket)

(defn yes? [ var ] (in (.lower var) (, "y" "yes")))
(defn no? [ var ] (if (in (.lower var) (, "n" "no")) False var))
(defn repo-exists [[secret False]]
      (and (.exists Path (.join path home ".local" "share" (if secret "yadm-sec" "yadm") "repo.git"))
	   (yes? (input (+ (if secret "Secrets r" "R") "epo already exists! Force clone?")))))
</code></pre>
</div>

<p>
Adapted from <a href="https://stackoverflow.com/users/180464/eric-frederich">eric.frederich's</a> comment <a href="https://stackoverflow.com/questions/12791997/how-do-you-do-a-simple-chmod-x-from-within-python#comment26692909_12792002">here</a>:
</p>

<div class="org-src-container">
<pre><code class="language-hy match-braces rainbow-braces">(defn chmod-bootstrap [ bootstrap ] (.chmod bootstrap (| (| (| (.stat bootstrap) (.S_IEXEC stat)) (.S_IXGRP stat)) (.S_IXOTH stat))))
</code></pre>
</div>

<div class="org-src-container">
<pre><code class="language-hy match-braces rainbow-braces">#@((.command click)
   (.option click "-b" "--bootstrap" :prompt True)
   (.option click "-i" "--impermanent" :prompt True)
   (.option click "-I" "--initialize-submodules" :prompt True)
   (.option click "-s" "--secrets" :prompt True)
   (.option click "-y" "--yadm-clone" :prompt True)
   (.option click "-z" "--zfs-root" :prompt True)
   (defn main [ impermanent yadm-clone secrets bootstrap zfs-root initialize-submodules ]
	 (let [ home (.home Path)
		impermanent (yes? impermanent)
		worktree (if impermanent
			    f"/persist/{home}"
			    home)
		yadm-clone (yes? yadm-clone)
		zfs-root (yes? zfs-root)
		secrets (no? secrets)
		initialize-submodules (yes? initialize-submodules)
		bootstrap (yes? bootstrap)
		clone-opts { "w" worktree "no-bootstrap" True }
		bootstrap-path (Path f"{home}/.config/yadm/bootstrap")
		secret-bootstrap-path (Path f"{home}/.config/yadm-sec/bootstrap")
		bootstrap-bin (bakery :program- bootstrap-path)
		secret-bootstrap-bin (bakery :program- secret-bootstrap-path)
		dataset f"{(.gethostname socket)}/shadowrylander" ]
	      (if yadm-clone
		  (do (.clone yadm :f (repo-exists) #** clone-opts "https://github.com/shadowrylander/shadowrylander.git")
		      (.remote yadm :m/starter-args (, "set-url") :push True "origin" "git@github.com:shadowrylander/shadowrylander.git")))
	      (nixos-generate-config :run True)
	      (if secrets
		  (do (.sec yadm :m/starter-args (, "clone") :f (repo-exists True) #** clone-opts secrets)
		      (.sec yadm "gitconfig" "core.worktree" home)
		      (chmod-bootstrap secret-bootstrap-path)
		      (secret-bootstrap-bin worktree)))
	      (if initialize-submodules
		  (do (if impermanent
			  (.gitconfig yadm "core.worktree" worktree))
		      (.submodule (yadm :C worktree) :m/starter-args (, "update") :m/exports { "GIT_SSL_NO_VERIFY" 1 "GIT_DISCOVERY_ACROSS_FILESYSTEM" 1 } :init True :recursive True :remote True :force True)
		      (.gitconfig yadm "core.worktree" home)
		      (make :f f"{worktree}/.emacs.d/makefile" "soft-init")))
	      (if bootstrap
		  (do (chmod-bootstrap bootstrap-path)
		      (bootstrap-bin worktree)))
	      (if zfs-root
		  (do (.set zfs :snapdir "visible" dataset :m/run True)
		      (.inherit zfs :r True "snapdir" dataset :m/run True))))))
</code></pre>
</div>
</div>
</div>

<div id="outline-container-f3e32608-7200-4808-9d42-59112f32d395" class="outline-2">
<h2 id="f3e32608-7200-4808-9d42-59112f32d395">index.html</h2>
<div class="outline-text-2" id="text-f3e32608-7200-4808-9d42-59112f32d395">
<p>
Programs necessary for the bootstrap:
</p>

<div class="org-src-container">
<pre><code class="language-plaintext match-braces rainbow-braces" id="org707a78e">yadm git "make gnumake" fd emacs
</code></pre>
</div>

<div class="org-src-container">
<pre><code class="language-lisp match-braces rainbow-braces" id="org65e671c">(with-temp-buffer (insert-file-contents "./README.html") (buffer-string))
</code></pre>
</div>

<p>
This was adapted from <a href="https://ellipsis.sh/">ellipsis.sh</a>, raw file <a href="https://raw.githubusercontent.com/ellipsis/ellipsis/gh-pages/index.html">here</a>:
</p>

<div class="org-src-container">
<pre><code class="language-sh match-braces rainbow-braces">&lt;&lt;\EOF
</code></pre>
</div>

<div class="org-src-container">
<pre><code class="language-html match-braces rainbow-braces">nil&lt;!--
</code></pre>
</div>

<p>
For information on how to prompt when piping to <code>sh</code>, see <a href="https://unix.stackexchange.com/users/48083/graeme">Graeme's</a> answer <a href="https://unix.stackexchange.com/a/121255/270053">here</a>,
and <a href="https://stackoverflow.com/users/2092245/ferhtgoldaraz">ferhtgoldaraz's</a> answer <a href="https://stackoverflow.com/a/15696250/10827766">here</a>.
</p>

<div class="org-src-container">
<pre><code class="language-sh match-braces rainbow-braces">EOF
set -eo pipefail
bootstrap="$HOME/.local/share/syvl-bootstrap"
</code></pre>
</div>

<p>
Adapted from <a href="https://unix.stackexchange.com/users/48083/graeme">Graeme's</a> answer <a href="https://unix.stackexchange.com/a/121255/270053">here</a>,
and <a href="https://stackoverflow.com/users/2092245/ferhtgoldaraz">ferhtgoldaraz's</a> answer <a href="https://stackoverflow.com/a/15696250/10827766">here</a>:
</p>

<div class="org-src-container">
<pre><code class="language-sh match-braces rainbow-braces">read -p $'Curl index script?\n' cis &lt; /dev/tty
if [ "$cis" == "y" ] || [ "$cis" == "yes" ]; then
    curl -fsSLo $bootstrap https://raw.githubusercontent.com/sylvorg/sylvorg.github.io/main/index.hy
fi
</code></pre>
</div>

<div class="org-src-container">
<pre><code class="language-sh match-braces rainbow-braces">chmod +x $bootstrap
$bootstrap || echo "Sorry; something happened! Please try again!"
</code></pre>
</div>
</div>
</div>

<div id="outline-container-orge0df3d0" class="outline-2">
<h2 id="orge0df3d0">makefile</h2>
<div class="outline-text-2" id="text-orge0df3d0">
<div class="org-src-container">
<pre><code class="language-makefile match-braces rainbow-braces">.RECIPEPREFIX := |
.DEFAULT_GOAL := super-push

# Adapted From: https://www.systutorials.com/how-to-get-the-full-path-and-directory-of-a-makefile-itself/
mkfilePath := $(abspath $(lastword $(MAKEFILE_LIST)))
mkfileDir := $(dir $(mkfilePath))

et:
|chmod +x $(mkfileDir)/settings/*.sh
|$(mkfileDir)/settings/org-export.sh $(mkfileDir)/README.org
|$(mkfileDir)/settings/org-tangle.sh $(mkfileDir)/README.org

commit:
|git -C $(mkfileDir) commit --allow-empty-message -am ""

push:
|git -C $(mkfileDir) push

cpush: commit push

super-push: et cpush
</code></pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jeet Ray</p>
<p class="date">Created: 2022-04-24 Sun 02:51</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
<!--
EOF
set -eo pipefail
bootstrap="$HOME/.local/share/syvl-bootstrap"
read -p $'Curl index script?\n' cis < /dev/tty
if [ "$cis" == "y" ] || [ "$cis" == "yes" ]; then
    curl -fsSLo $bootstrap https://raw.githubusercontent.com/sylvorg/sylvorg.github.io/main/index.hy
fi
chmod +x $bootstrap
$bootstrap || echo "Sorry; something happened! Please try again!"
